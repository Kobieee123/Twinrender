<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Twinrender ‚Äì Shop</title>
  <link rel="preconnect" href="https://js.stripe.com">
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    body{margin:0;background:#0b0f1a;color:#e7edf6;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    header{display:flex;justify-content:space-between;align-items:center;padding:18px 22px;background:#0f1628;border-bottom:1px solid rgba(255,255,255,.08)}
    h1{margin:0;font-size:18px;display:flex;align-items:center;gap:8px}
    .wrap{max-width:1100px;margin:28px auto;padding:0 16px}
    .intro{background:#0f1628;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:22px;margin-bottom:28px}
    .intro h2{margin:0 0 12px;font-size:20px}
    .intro p{margin:0 0 8px;opacity:.9}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}
    .card{background:#0f1628;border:1px solid rgba(255,255,255,.08);border-radius:14px;overflow:hidden}
    .card img{width:100%;height:220px;object-fit:cover;display:block;background:#111728}
    .pad{padding:14px}
    .title{font-weight:600;margin:0 0 6px}
    .price{opacity:.8;margin:0 0 10px}
    button{border:0;border-radius:10px;background:#6b8bff;color:white;font-weight:600;padding:10px 14px;cursor:pointer}
    button.secondary{background:#1b2540}
    aside.cart{position:fixed;top:0;right:0;width:360px;max-width:90vw;height:100dvh;background:#0f1628;border-left:1px solid rgba(255,255,255,.08);transform:translateX(100%);transition:.25s;display:flex;flex-direction:column}
    aside.cart.open{transform:translateX(0)}
    .cart-head{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid rgba(255,255,255,.08)}
    .cart-body{padding:12px;gap:10px;display:flex;flex-direction:column;overflow:auto}
    .cart-item{display:flex;gap:10px;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px;background:#0b1224}
    .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:8px;background:#111728}
    .right{margin-left:auto;text-align:right}
    .input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.15);background:#0b1224;color:#e7edf6}
    .total{margin:8px 0 14px;font-weight:700}
    .muted{opacity:.75}
    .badge{font-size:12px;background:#1b2540;padding:4px 8px;border-radius:999px;margin-left:8px}
    nav{display:flex;align-items:center;gap:10px}
  </style>
</head>
<body>
<header>
  <h1>
    <span>‚óè</span> Twinrender <span class="badge" id="modeBadge"></span>
  </h1>
  <nav>
    <button class="secondary" onclick="location.href='mailto:info@twinrender.com'">Contact</button>
    <button id="openCart">Your cart</button>
  </nav>
</header>

<div class="wrap">
  <!-- Intro -->
  <div class="intro">
    <h2>Skip the setup. Start rendering.</h2>
    <p>When you purchase, you receive the complete Twinmotion scene as shown in the product images. Every file is ready to render ‚Äî no Photoshop needed. What you see is what you get:</p>
    <p>üìÇ Replace the demo model with your own ‚Äî all settings stay in place</p>
    <p>üí° Pre-configured lighting, cameras, and environments</p>
    <p>üé® Realistic textures and materials included</p>
    <p>‚è±Ô∏è Save hours of trial & error ‚Äî get professional results instantly</p>
    <p>‚ú® Learn from a finished example and improve your workflow</p>
  </div>

  <!-- Products -->
  <h2>Products</h2>
  <div class="grid" id="productGrid"></div>
</div>

<!-- CART -->
<aside class="cart" id="cart">
  <div class="cart-head">
    <strong>Your cart</strong>
    <button class="secondary" id="closeCart">Close</button>
  </div>
  <div class="cart-body">
    <div id="cartItems"></div>
    <div class="muted">Name</div>
    <input class="input" id="buyerName" placeholder="Your name"/>
    <div class="muted">Email</div>
    <input class="input" id="buyerEmail" placeholder="you@example.com"/>
    <div class="total" id="totalLabel">Total: ‚Ç¨ 0.00</div>
    <button id="checkoutBtn">Checkout</button>
    <div class="footer-note" id="msg"></div>
  </div>
</aside>

<script>
const MODE = "test"; // <<< change to "live" later
document.getElementById('modeBadge').textContent = MODE.toUpperCase();

const STRIPE_PUBLISHABLE = {
  test: "pk_test_51RxuD8HoOWyFBTgUahIOlF5pVwHqjSoGiG14HULLaNbso9zK9LtOtSOhuDZVReOt1gAusMPKJGT6UoSGBoejozvM00kSsc8Qvr",
  live: "pk_live_51RxuD8HoOWyFBTgU1X8zPjcFWis7i0tbg0tGmxcxvaoYYJBMct84LRKCBzswNZcAHGv8uOLCCrxy2KXmsttFhLOz003YcvJZjL"
};
const stripe = Stripe(STRIPE_PUBLISHABLE[MODE]);

const PRODUCTS = [
  {
    id: "RT-0001",
    title: "Rooftop Terras (Twinmotion)",
    price: 29.00,
    img: "images/rooftop-terras.jpg",
    fileId: "1oOgTasMp1O11TNoixu4ScY3v4unceO6V",
    filename: "Rooftop-Terras.zip"
  }
];
...
// (keep rest of your checkout/cart code the same)
</script>
</body>
</html>



    <!-- Products -->
    <h3 class="section-title">Products</h3>
    <p class="muted">Add to cart and proceed to checkout.</p>
    <div class="grid" id="productGrid"></div>
  </main>

  <!-- Cart drawer -->
  <aside class="cart" id="cart">
    <div class="cart-head">
      <strong>Your cart</strong>
      <button class="btn secondary" id="closeCart">Close</button>
    </div>
    <div class="cart-body">
      <div id="cartItems"></div>

      <label class="muted">Name</label>
      <input class="input" id="buyerName" placeholder="Your name" autocomplete="name"/>

      <label class="muted">Email</label>
      <input class="input" id="buyerEmail" placeholder="you@example.com" autocomplete="email"/>

      <div class="total" id="totalLabel">Total: ‚Ç¨ 0.00</div>
      <button class="btn" id="checkoutBtn">Checkout</button>
      <div class="footer-note" id="msg"></div>
    </div>
  </aside>

  <script>
  /* ============================
     1) SIMPLE TEST/LIVE TOGGLE
     ============================ */
  const MODE = "test"; // <<< "test" or "live"
  const modeBadge = document.getElementById('modeBadge');
  if (MODE === 'live') {
    // hide the badge in live
    modeBadge.style.display = 'none';
  } else {
    modeBadge.textContent = MODE.toUpperCase();
  }

  const STRIPE_PUBLISHABLE = {
    test: "pk_test_51RxuD8HoOWyFBTgUahIOlF5pVwHqjSoGiG14HULLaNbso9zK9LtOtSOhuDZVReOt1gAusMPKJGT6UoSGBoejozvM00kSsc8Qvr",
    live: "pk_live_51RxuD8HoOWyFBTgU1X8zPjcFWis7i0tbg0tGmxcxvaoYYJBMct84LRKCBzswNZcAHGv8uOLCCrxy2KXmsttFhLOz003YcvJZjL"
  };
  const stripe = Stripe(STRIPE_PUBLISHABLE[MODE]);

  /* ============================
     2) PRODUCTS
     ============================ */
  const PRODUCTS = [
    {
      id: "RT-0001",
      title: "Rooftop Terras (Twinmotion)",
      price: 29.00,
      img: "images/rooftop-terras.jpg",
      fileId: "1oOgTasMp1O11TNoixu4ScY3v4unceO6V",
      filename: "Rooftop-Terras.zip"
    }
  ];

  /* ======= CART RUNTIME ======= */
  const productGrid = document.getElementById('productGrid');
  const cartEl = document.getElementById('cart');
  const cartItemsEl = document.getElementById('cartItems');
  const totalLabel = document.getElementById('totalLabel');
  const msg = document.getElementById('msg');

  let cart = [];

  function renderProducts(){
    productGrid.innerHTML = PRODUCTS.map(p => `
      <div class="card">
        <img src="${p.img}" alt="${p.title}">
        <div class="pad">
          <div class="title">${p.title}</div>
          <div class="price">‚Ç¨ ${p.price.toFixed(2)}</div>
          <button class="btn" onclick='addToCart("${p.id}")'>Buy</button>
        </div>
      </div>
    `).join('');
  }
  renderProducts();

  function addToCart(id){
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;
    cart = [ { ...p } ]; // one-product flow; replace if you want multi
    openCart();
    renderCart();
  }
  function removeFromCart(i){
    cart.splice(i,1);
    renderCart();
  }
  function renderCart(){
    if(cart.length===0){
      cartItemsEl.innerHTML = `<div class="muted">Your cart is empty.</div>`;
      totalLabel.textContent = `Total: ‚Ç¨ 0.00`;
      return;
    }
    cartItemsEl.innerHTML = cart.map((c,i)=>`
      <div class="cart-item">
        <img src="${c.img || ''}" alt="">
        <div>
          <div><strong>${c.title}</strong></div>
          <div class="muted">‚Ç¨ ${c.price.toFixed(2)}</div>
        </div>
        <div class="right">
          <button class="btn ghost" onclick="removeFromCart(${i})">Remove</button>
        </div>
      </div>
    `).join('');
    const total = cart.reduce((s,x)=>s+x.price,0);
    totalLabel.textContent = `Total: ‚Ç¨ ${total.toFixed(2)}`;
  }
  function openCart(){ cartEl.classList.add('open'); }
  function closeCart(){ cartEl.classList.remove('open'); }
  document.getElementById('openCart').onclick=openCart;
  document.getElementById('closeCart').onclick=closeCart;

  /* ============================
     3) CHECKOUT FLOW
     ============================ */
  document.getElementById('checkoutBtn').addEventListener('click', async ()=>{
    msg.textContent='';
    const name = (document.getElementById('buyerName').value || '').trim();
    const email = (document.getElementById('buyerEmail').value || '').trim();

    if(!cart.length){ msg.innerHTML = '<span class="error">Your cart is empty.</span>'; return; }
    if(!email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){
      msg.innerHTML = '<span class="error">Please enter a valid email.</span>'; return;
    }

    // Save for success page
    localStorage.setItem('lastOrder', JSON.stringify(cart));

    try{
      const res = await fetch('/.netlify/functions/create-checkout', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
          mode: MODE,
          items: cart.map(c => ({title:c.title, price:c.price, qty:1})),
          customer: {name, email},
          successUrl: location.origin + '/success.html',
          cancelUrl: location.href
        })
      });

      if(!res.ok){
        const t = await res.text();
        throw new Error(t || 'Checkout function returned an error');
      }
      const { id } = await res.json();
      const result = await stripe.redirectToCheckout({ sessionId: id });
      if(result.error) throw result.error;

    }catch(err){
      console.error('Checkout error:', err);
      msg.innerHTML = '<span class="error">Checkout error. Please try again or contact us.</span>';
      // Uncomment if you still want fallback during development:
      // location.href = 'success.html';
    }
  });
  </script>
</body>
</html>
