<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Twinrender – Shop</title>

  <!-- Stripe loader (unchanged) -->
  <link rel="preconnect" href="https://js.stripe.com">
  <script src="https://js.stripe.com/v3/"></script>

  <!-- Favicon -->
  <link rel="icon" href="Images/Logo.png" type="image/png">

<style>
  :root{
    /* pulled from your logo */
    --brand:#8fb2d9;

    /* neutral palette (no pure black) */
    --ink-900:#101522;
    --ink-800:#1b2333;
    --ink-700:#2a344a;
    --ink-600:#3f4b67;
    --ink-500:#5e6a86;
    --ink-400:#7f8aa3;
    --ink-300:#aab3c4;

    --bg:#ffffff;
    --card:#eef4fb;         /* banner + button fill (light brand blue) */
    --border:#e5e9f1;

    --radius:14px;
    --radius-lg:18px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink-900);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  a{color:inherit;text-decoration:none}

  /* Single container class used by header, content and footer for perfect alignment */
  .wrap{max-width:1180px;margin:0 auto;padding:0 24px}

  /* ===== HEADER (2 rows) ===== */
  header.site{
    border-bottom:1px solid var(--border); background:var(--bg);
    position:sticky; top:0; z-index:10
  }
  .topbar{
    display:flex; align-items:center; justify-content:space-between;
    gap:16px; padding:12px 0
  }
  .brand{display:flex; align-items:center; gap:14px}
  .brand img{height:88px; width:auto; object-fit:contain; display:block}  /* big logo */
  .brand .name{display:flex; flex-direction:column; line-height:1.1}
  .brand .title{font-weight:800; font-size:22px}
  .brand .sub{font-size:12px; color:var(--ink-500)}

  /* mini cart */
  .cart-mini{display:flex; align-items:center; gap:12px}
  .cart-mini .totals{text-align:right; min-width:120px; color:var(--ink-600); font-size:13px; line-height:1.2}
  .cart-mini .totals strong{display:block; color:var(--ink-800); font-size:14px}
  .icon-btn{display:inline-flex; align-items:center; justify-content:center; width:42px; height:42px; border-radius:12px; border:1px solid var(--border); background:var(--bg); cursor:pointer}
  .icon-btn svg{width:20px;height:20px;stroke:var(--ink-800)}
  #openCart{display:none}

  /* second row nav */
  .second{display:flex; align-items:center; justify-content:space-between; gap:16px; padding:8px 0 14px}
  .nav-links{display:flex; gap:8px; flex-wrap:wrap}
  .nav-links a{padding:8px 12px; border:1px solid var(--border); border-radius:10px; font-weight:600; color:var(--ink-800); background:var(--bg)}
  .nav-links a:hover{background:#f9fbff}
  .search{display:flex; gap:8px; align-items:center; min-width:320px}
  .search input{width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#fff; color:var(--ink-900)}

  @media (max-width:720px){
    #openCart{display:inline-flex}
    .icon-btn{display:none}
    .second{flex-direction:column; align-items:flex-start}
    .search{min-width:0; width:100%}
  }

  /* ===== INTRO BANNER (brand blue) ===== */
  .intro{
    background:var(--brand);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    padding:22px;
    margin:22px auto;
    color:#0d2239;
  }
  .intro h2{margin:0 0 10px 0; font-size:26px}
  .intro p{margin:0 0 12px 0; color:#0d2239}
  .bullets{margin:10px 0 0 0; padding-left:0; list-style:none; display:grid; gap:8px}
  .bullets li{display:flex; gap:10px; align-items:flex-start}

  /* headings */
  .section{margin:28px 0 8px; font-weight:800; font-size:20px; color:var(--ink-800)}
  .section-sub{margin:0 0 16px; color:var(--ink-500); font-size:14px}

  /* ===== PRODUCT GRID ===== */
  .grid{display:grid; gap:18px; grid-template-columns:repeat(3,1fr)}
  @media (max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:640px){.grid{grid-template-columns:1fr}}

  .card{border:1px solid var(--border); background:#fff; border-radius:var(--radius); overflow:hidden; display:flex; flex-direction:column}
  .card .img-wrap{width:100%; aspect-ratio:1/1; overflow:hidden; background:#f4f7fb}
  .card img{width:100%; height:100%; object-fit:cover; display:block}
  .pad{padding:14px}
  .title{font-weight:800; margin:0 0 6px}
  .price{opacity:.9;margin:0 0 12px; color:var(--ink-600)}
  .btn{
    border:0; border-radius:999px;            /* rounded add-to-cart */
    background:var(--card);                   /* same fill as banner */
    color:var(--ink-800); font-weight:800; padding:12px 16px; cursor:pointer; width:100%;
    border:1px solid var(--border);
  }
  .btn:hover{filter:brightness(0.97)}

  /* ===== CART DRAWER ===== */
  aside.cart{
    position:fixed; top:0; right:0; width:380px; max-width:90vw; height:100dvh;
    background:#fff; border-left:1px solid var(--border);
    transform:translateX(100%); transition:.25s; display:flex; flex-direction:column;
    box-shadow:-8px 0 18px rgba(0,0,0,.06);
    z-index: 9999; /* <-- always above sticky header */
  }
  aside.cart.open{transform:translateX(0)}
  .cart-head{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid var(--border)}
  .cart-body{padding:12px;gap:10px;display:flex;flex-direction:column;overflow:auto}
  .cart-item{display:flex;gap:10px;border:1px solid var(--border);border-radius:12px;padding:10px;background:#fff}
  .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:8px;background:#f4f7fb}
  .input{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#fff;color:var(--ink-900)}
  .total{margin:8px 0 14px;font-weight:900}

  /* ===== FOOTER ===== */
  footer.site{margin-top:40px; background:var(--brand); color:#0d2239; border-top:1px solid var(--border)}
  .foot{display:grid; gap:28px; padding:28px 0; grid-template-columns: 1.2fr 1fr 1fr}
  @media (max-width:900px){ .foot{grid-template-columns:1fr} }
  .foot h4{margin:0 0 10px; font-size:14px}
  .foot p,.foot a,.foot li{color:#0d2239; font-size:14px}
  .foot ul{list-style:none; padding:0; margin:0; display:grid; gap:8px}
  .foot select{padding:8px 10px; border:1px solid var(--border); border-radius:10px; background:#fff}

  /* Nudge the combined logo + text to align with content column */
  .topbar .brand{ margin-left:-12px }
  @media (max-width:720px){ .topbar .brand{ margin-left:0 } }

/* ===== ALIGNMENT FIX (Header + Footer) ===== */

/* Ensure consistent inner width + padding */
.wrap {
  max-width: 1180px;
  margin: 0 auto;
  padding: 0 24px;
}

/* Fix brand/logo so it aligns with the red line */
.topbar .brand {
  margin-left: 0 !important;
}

/* Apply same gutter rules to header + footer */
header.site .wrap,
footer.site .wrap {
  padding-left: 24px;
  padding-right: 24px;
  margin: 0 auto;
  max-width: 1180px;
}

/* === Small tweaks for alignment & spacing === */

/* Move logo + Twinrender text 60px left */
.topbar .brand {
  position: relative;
  left: -60px;
}

/* Add more space inside footer banner */
footer.site .foot {
  padding-top: 48px;   /* increase top space */
  padding-bottom: 48px; /* increase bottom space */
}

</style>


</head>
<body>

  <!-- HEADER -->
  <header class="site">
    <div class="wrap">
      <!-- Row 1: brand + mini cart -->
      <div class="topbar">
        <a class="brand" href="index.html" aria-label="Go to shop">
          <img src="Images/Logo.png" alt="Twinrender logo" onerror="this.style.display='none'">
          <div class="name">
            <div class="title">Twinrender</div>
            <div class="sub">ready to use with Twinmotion</div>
          </div>
        </a>

        <div class="cart-mini">
          <div class="totals">
            <strong><span id="cartTotal">€ 0.00</span></strong>
            <span><span id="cartQty">0</span> item(s)</span>
          </div>
          <button class="icon-btn" aria-label="Open cart" onclick="document.getElementById('openCart').click()">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8">
              <path d="M6 6h15l-1.5 9h-13L5 3H2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="9" cy="21" r="1.6" stroke="currentColor"/>
              <circle cx="18" cy="21" r="1.6" stroke="currentColor"/>
            </svg>
          </button>
          <button id="openCart" style="display:none;">Your cart</button>
        </div>
      </div>

      <!-- Row 2: links + search -->
      <div class="second">
        <nav class="nav-links" aria-label="primary">
          <a href="index.html">Shop</a>
          <a href="https://www.instagram.com/archiprogress" target="_blank" rel="noopener">My account</a>
          <a href="mailto:Twinrender@hotmail.com?subject=Twinrender%20inquiry">Contact</a>
          <a href="#" onclick="alert('Terms of use are coming soon.'); return false;">Terms of use</a>
        </nav>
        <div class="search" role="search">
          <input id="searchBox" type="search" placeholder="Search products…" autocomplete="off">
        </div>
      </div>
    </div>
  </header>

  <!-- INTRO BANNER -->
  <div class="wrap">
    <section class="intro" aria-label="intro">
      <h2>Skip the setup. Start rendering.</h2>
      <p>
        When you purchase, you get the exact Twinmotion source file of the render images shown.
        Use it as your shortcut to high-quality results. What you see is what you get —
        just swap in your model and hit render.
      </p>
      <ul class="bullets">
        <li><span>📂</span> Replace my model with yours — all settings stay in place</li>
        <li><span>💡</span> Perfectly tuned lighting, cameras and environments</li>
        <li><span>🎨</span> Realistic materials and textures ready to go</li>
        <li><span>⏱️</span> Save hours of trial &amp; error — render professional images instantly</li>
        <li><span>✨</span> Learn from a complete example and improve your workflow</li>
      </ul>
    </section>

    <h3 class="section">Products</h3>
    <p class="section-sub">Add to cart and proceed to checkout.</p>

    <!-- Grid where JS renders products -->
    <div class="grid" id="productGrid"></div>
  </div>

  <!-- CART DRAWER (unchanged ids) -->
  <aside class="cart" id="cart" aria-label="cart drawer">
    <div class="cart-head">
      <strong>Your cart</strong>
      <button class="icon-btn" id="closeCart" aria-label="Close cart">
        ✕
      </button>
    </div>
    <div class="cart-body">
      <div id="cartItems"></div>

      <div>Name</div>
      <input class="input" id="buyerName" placeholder="Your name"/>
      <div>Email</div>
      <input class="input" id="buyerEmail" placeholder="you@example.com"/>

      <div class="total" id="totalLabel">Total: € 0.00</div>
      <button class="btn" id="checkoutBtn">Checkout</button>
      <div class="footer-note" id="msg"></div>
    </div>
  </aside>

  <!-- FOOTER (brand blue) -->
  <footer class="site">
    <div class="wrap foot">
      <div>
        <h4>Pages</h4>
        <ul>
          <li><a href="index.html">Shop</a></li>
          <li><a href="https://www.instagram.com/archiprogress" target="_blank" rel="noopener">My account</a></li>
          <li><a href="mailto:Twinrender@hotmail.com?subject=Twinrender%20inquiry">Contact</a></li>
          <li><a href="#" onclick="alert('Terms of use are coming soon.'); return false;">Terms of use</a></li>
        </ul>
      </div>

      <div>
        <h4>Cart</h4>
        <p><strong id="cartTotal_footer">€ 0.00</strong> • <span id="cartQty_footer">0</span> items</p>

        <h4 style="margin-top:16px">Currency (display only)</h4>
        <select id="currencySelect" aria-label="Choose currency">
          <option value="EUR" selected>EUR (€)</option>
          <option value="USD">USD ($)</option>
        </select>
        <p style="margin-top:6px;font-size:12px">
          Note: checkout is processed in EUR.
        </p>
      </div>

      <div>
        <h4>About</h4>
        <p>
          Twinrender<br>
          <a href="mailto:Twinrender@hotmail.com">Twinrender@hotmail.com</a><br>
          Instagram: <a href="https://www.instagram.com/archiprogress" target="_blank" rel="noopener">@archiprogress</a>
        </p>
      </div>
    </div>
  </footer>



<script>
/* =========================================
   0) MODE + STRIPE KEYS (unchanged)
   ========================================= */
const MODE = "test"; // "test" or "live"
document.getElementById('modeBadge')?.append(document.createTextNode(MODE.toUpperCase()));

const STRIPE_PUBLISHABLE = {
  test: "pk_test_51RxuD8HoOWyFBTgUahIOlF5pVwHqjSoGiG14HULLaNbso9zK9LtOtSOhuDZVReOt1gAusMPKJGT6UoSGBoejozvM00kSsc8Qvr",
  live: "pk_live_51RxuD8HoOWyFBTgU1X8zPjcFWis7i0tbg0tGmxcxvaoYYJBMct84LRKCBzswNZcAHGv8uOLCCrxy2KXmsttFhLOz003YcvJZjL"
};
const stripe = Stripe(STRIPE_PUBLISHABLE[MODE]);

/* =========================================
   1) PRODUCTS (unchanged data)
   ========================================= */
const PRODUCTS = [
  {
    id: "RT-0001",
    title: "Rooftop Terras (Twinmotion)",
    price: 29.00,
    img: "images/rooftop-terras.jpg",
    fileId: "1oOgTasMp1O11TNoixu4ScY3v4unceO6V",
    filename: "Rooftop-Terras.zip"
  }
];

/* =========================================
   2) RUNTIME STATE + HELPERS
   ========================================= */
let cart = [];                // {id, title, price, img, fileId, filename}
let DISPLAY_CURRENCY = "EUR"; // display only (EUR/USD)
const EUR_TO_USD = 1.1;       // simple display rate, not used for charging

// Elements
const productGrid   = document.getElementById('productGrid');
const cartEl        = document.getElementById('cart');
const cartItemsEl   = document.getElementById('cartItems');
const totalLabel    = document.getElementById('totalLabel');
const msg           = document.getElementById('msg');
const currencySelect= document.getElementById('currencySelect');
const searchInput   = document.getElementById('searchBox');

// safe setText helper
function setText(id, value) {
  const el = document.getElementById(id);
  if (el) el.textContent = value;
}

// pure display formatter
function displayPrice(eur) {
  if (DISPLAY_CURRENCY === "USD") {
    return `$ ${(Number(eur) * EUR_TO_USD).toFixed(2)}`;
  }
  return `€ ${Number(eur).toFixed(2)}`;
}

function calcSubtotalEUR() {
  return cart.reduce((sum, item) => sum + Number(item.price || 0), 0);
}

function updateHeaderFooterTotals() {
  const qty = cart.length;
  const eur = Number(totalLabel?.dataset.eur || 0);
  const shown = displayPrice(eur);
  setText('cartQty', qty);
  setText('cartTotal', shown);
  setText('cartQty_footer', qty);
  setText('cartTotal_footer', shown);
}

/* =========================================
   3) RENDER PRODUCTS / CART
   ========================================= */
function renderProducts(list = PRODUCTS) {
  if (!productGrid) return;
  productGrid.innerHTML = list.map(p => `
    <div class="card">
      <div class="img-wrap"><img src="${p.img}" alt=""></div>
      <div class="pad">
        <div class="title">${p.title}</div>
        <div class="price">${displayPrice(p.price)}</div>
        <button class="btn" onclick='addToCart("${p.id}")'>Buy</button>
      </div>
    </div>
  `).join('');
}

function renderCart() {
  if (!cartItemsEl || !totalLabel) return;

  if (cart.length === 0) {
    cartItemsEl.innerHTML = `<div class="muted">Your cart is empty.</div>`;
    totalLabel.dataset.eur = "0.00";
    totalLabel.textContent = `Total: ${displayPrice(0)}`;
    updateHeaderFooterTotals();
    return;
  }

  cartItemsEl.innerHTML = cart.map((c, i) => `
    <div class="cart-item">
      <img src="${c.img || ''}" alt="">
      <div>
        <div><strong>${c.title}</strong></div>
        <div class="muted">${displayPrice(c.price)}</div>
      </div>
      <div class="right">
        <button class="secondary" onclick="removeFromCart(${i})">Remove</button>
      </div>
    </div>
  `).join('');

  // subtotal (numeric) + display
  const eur = calcSubtotalEUR();
  totalLabel.dataset.eur = eur.toFixed(2);             // keep numeric safe
  totalLabel.textContent = `Total: ${displayPrice(eur)}`;
  updateHeaderFooterTotals();
}

/* =========================================
   4) ACTIONS
   ========================================= */
function addToCart(id) {
  const p = PRODUCTS.find(x => x.id === id);
  if (!p) return;
  cart.push({ ...p });
  openCart();
  renderCart();
}

function removeFromCart(i) {
  cart.splice(i, 1);
  renderCart();
}

function openCart(){ cartEl?.classList.add('open'); }
function closeCart(){ cartEl?.classList.remove('open'); }
document.getElementById('openCart')?.addEventListener('click', openCart);
document.getElementById('closeCart')?.addEventListener('click', closeCart);

/* =========================================
   5) SEARCH (display only)
   ========================================= */
if (searchInput) {
  searchInput.addEventListener('input', () => {
    const q = searchInput.value.trim().toLowerCase();
    const filtered = PRODUCTS.filter(p => p.title.toLowerCase().includes(q));
    renderProducts(filtered);
  });
}

/* =========================================
   6) CURRENCY SELECT (display only)
   ========================================= */
if (currencySelect) {
  currencySelect.addEventListener('change', () => {
    DISPLAY_CURRENCY = currencySelect.value; // "EUR" | "USD"
    renderProducts();         // update product labels
    renderCart();             // relabel totals with same numeric EUR
  });
}

/* =========================================
   7) CHECKOUT (unchanged mechanics)
   ========================================= */
document.getElementById('checkoutBtn')?.addEventListener('click', async () => {
  msg.textContent = '';

  const name  = document.getElementById('buyerName')?.value.trim();
  const email = document.getElementById('buyerEmail')?.value.trim();

  if (!cart.length) { msg.textContent = "Your cart is empty."; return; }
  if (!email)       { msg.textContent = "Please enter your email."; return; }

  // keep files for success page
  localStorage.setItem('lastOrder', JSON.stringify(cart));

  try {
    const res = await fetch('/.netlify/functions/create-checkout', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        mode: MODE,
        items: cart.map(c => ({ title: c.title, price: c.price, qty: 1 })),
        customer: { name, email },
        successUrl: location.origin + '/success.html',
        cancelUrl: location.href
      })
    });

    if (!res.ok) throw new Error(await res.text());
    const { id } = await res.json();
    const result = await stripe.redirectToCheckout({ sessionId: id });
    if (result.error) throw result.error;

  } catch (err) {
    console.warn('Checkout error, going to success test flow:', err);
    // fallback so you can still test downloads
    location.href = 'success.html';
  }
});

/* =========================================
   8) INITIAL RENDER
   ========================================= */
renderProducts();
renderCart();
</script>
</body>
</html>
