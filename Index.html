<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Twinrender – Shop</title>

  <!-- Stripe script can stay here (your JS below will use it) -->
  <link rel="preconnect" href="https://js.stripe.com">
  <script src="https://js.stripe.com/v3/"></script>

  <style>
    :root{
      --bg:#0b0f1a;
      --panel:#0f1628;
      --line:rgba(255,255,255,.10);
      --muted:rgba(231,237,246,.75);
      --text:#e7edf6;
      --brand:#6b8bff;
      --brand-2:#3d58ff;
      --chip:#1b2540;
      --ok:#3ecf8e;
    }

    /* Reset */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit;text-decoration:none}

    /* Header */
    header{
      position:sticky; top:0; z-index:10;
      display:flex; align-items:center; justify-content:space-between;
      gap:16px;
      padding:14px 18px;
      background:var(--panel);
      border-bottom:1px solid var(--line);
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:700}
    .dot{width:8px;height:8px;border-radius:50%;background:#4ade80;box-shadow:0 0 10px #4ade80}
    .mode-badge{
      margin-left:8px; padding:2px 6px; border-radius:999px;
      background:var(--chip); font-size:12px; color:#cbd5e1;
    }
    .actions{display:flex; gap:10px; align-items:center}
    .btn{
      border:1px solid var(--line); background:#0b1224; color:var(--text);
      padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600;
    }
    .btn.primary{background:var(--brand); border-color:var(--brand); color:#fff}
    .btn.primary:hover{background:var(--brand-2)}

    /* Page wrapper */
    .wrap{max-width:1100px;margin:28px auto;padding:0 16px}

    /* Intro/Hero card */
    .hero{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:16px;
      padding:22px 22px 18px;
      margin-bottom:22px;
    }
    .hero h2{margin:0 0 10px}
    .sub{color:var(--muted); margin:0 0 4px}
    .bullets{
      margin:10px 0 0;
      padding-left:20px; /* indent bullets nicely */
      color:var(--text);
    }
    .bullets li{margin:6px 0}

    /* Section headings */
    h3.section{margin:18px 0 8px}
    .muted{color:var(--muted)}

    /* Product grid — 1/2/3 columns responsively */
    .grid{
      display:grid;
      grid-template-columns: repeat(1, 1fr);
      gap:18px;
    }
    @media (min-width:700px){
      .grid{grid-template-columns:repeat(2,1fr)}
    }
    @media (min-width:1024px){
      .grid{grid-template-columns:repeat(3,1fr)}
    }

    /* Product card */
    .card{
      background:#0b1224;
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      display:flex; flex-direction:column;
    }
    .card img{
      width:100%;
      aspect-ratio:1/1;      /* perfect square */
      object-fit:cover;      /* crop nicely */
      display:block;
      background:#111728;
    }
    .pad{padding:14px}
    .title{font-weight:700;margin:0 0 6px}
    .price{color:var(--muted);margin:0 0 12px}
    .fullbtn{
      width:100%; border:1px solid var(--brand); background:var(--brand);
      color:white; padding:12px 14px; border-radius:10px; cursor:pointer; font-weight:700;
    }
    .fullbtn:hover{background:var(--brand-2)}

    /* Cart Drawer */
    aside.cart{
      position:fixed; top:0; right:0; height:100dvh; width:360px; max-width:90vw;
      background:var(--panel); border-left:1px solid var(--line);
      transform:translateX(100%); transition:.25s;
      display:flex; flex-direction:column;
    }
    aside.cart.open{transform:translateX(0)}
    .cart-head{
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 16px; border-bottom:1px solid var(--line);
    }
    .cart-body{padding:12px; gap:10px; display:flex; flex-direction:column; overflow:auto}
    .cart-item{
      display:flex; gap:10px; align-items:center;
      border:1px solid var(--line); border-radius:12px; padding:10px; background:#0b1224;
    }
    .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:8px;background:#111728}
    .right{margin-left:auto}
    .input{
      width:100%; padding:10px; border-radius:8px; border:1px solid var(--line);
      background:#0b1224; color:var(--text);
    }
    .total{font-weight:800}
    .footer-note{color:#fca5a5}
  </style>
</head>

<body>
  <header>
    <div class="brand">
      <span class="dot"></span>
      Twinrender
      <span id="modeBadge" class="mode-badge">TEST</span>
    </div>
    <div class="actions">
      <a class="btn" href="mailto:twinrender@hotmail.com">Contact</a>
      <button id="openCart" class="btn primary">Your cart</button>
    </div>
  </header>

  <div class="wrap">
    <!-- Hero / Intro -->
    <section class="hero">
      <h2>Skip the setup. Start rendering.</h2>
      <p class="sub">
        You receive the exact Twinmotion source file used for the images shown — a shortcut to consistent, high-quality results.
      </p>
      <ul class="bullets">
        <li>📂 Replace my model with yours — all settings stay in place</li>
        <li>💡 Perfectly tuned lighting, cameras and environments</li>
        <li>🎨 Realistic materials and textures ready to go</li>
        <li⏱️ Save hours of trial &amp; error — render professional images instantly</li>
        <li>✨ Learn from a complete example and improve your own workflow</li>
      </ul>
    </section>

    <!-- Additional intro (rewritten copy you asked to include) -->
    <section class="hero" style="padding-top:18px">
      <p class="sub" style="margin:0">
        Complete Twinmotion scenes with all 3D models, textures, lighting and camera setups exactly as seen in the product visuals.
        No Photoshop needed — what you see is what you get. Perfect for visualizers and architects who want reliable, repeatable quality:
        drop your own project into the scene and reuse the render settings to create great images fast.
      </p>
    </section>

    <!-- Products -->
    <h3 class="section">Products</h3>
    <p class="muted" style="margin-top:4px">Add to cart and proceed to checkout.</p>

    <div class="grid" id="productGrid"><!-- cards injected by your JS --></div>
  </div>

  <!-- Cart Drawer (ids must match your JS) -->
  <aside class="cart" id="cart">
    <div class="cart-head">
      <strong>Your cart</strong>
      <button class="btn" id="closeCart">Close</button>
    </div>
    <div class="cart-body">
      <div id="cartItems"></div>

      <div class="muted">Name</div>
      <input class="input" id="buyerName" placeholder="Your name" />

      <div class="muted">Email</div>
      <input class="input" id="buyerEmail" placeholder="you@example.com" />

      <div class="total" id="totalLabel">Total: € 0.00</div>
      <button class="fullbtn" id="checkoutBtn">Checkout</button>
      <div class="footer-note" id="msg"></div>
    </div>
  </aside>


  <script>
  /* ============================
     1) SIMPLE TEST/LIVE TOGGLE
     ============================ */
  const MODE = "test"; // <<< "test" or "live"
  const modeBadge = document.getElementById('modeBadge');
  if (MODE === 'live') {
    // hide the badge in live
    modeBadge.style.display = 'none';
  } else {
    modeBadge.textContent = MODE.toUpperCase();
  }

  const STRIPE_PUBLISHABLE = {
    test: "pk_test_51RxuD8HoOWyFBTgUahIOlF5pVwHqjSoGiG14HULLaNbso9zK9LtOtSOhuDZVReOt1gAusMPKJGT6UoSGBoejozvM00kSsc8Qvr",
    live: "pk_live_51RxuD8HoOWyFBTgU1X8zPjcFWis7i0tbg0tGmxcxvaoYYJBMct84LRKCBzswNZcAHGv8uOLCCrxy2KXmsttFhLOz003YcvJZjL"
  };
  const stripe = Stripe(STRIPE_PUBLISHABLE[MODE]);

  /* ============================
     2) PRODUCTS
     ============================ */
  const PRODUCTS = [
    {
      id: "RT-0001",
      title: "Rooftop Terras (Twinmotion)",
      price: 29.00,
      img: "images/rooftop-terras.jpg",
      fileId: "1oOgTasMp1O11TNoixu4ScY3v4unceO6V",
      filename: "Rooftop-Terras.zip"
    }
  ];

  /* ======= CART RUNTIME ======= */
  const productGrid = document.getElementById('productGrid');
  const cartEl = document.getElementById('cart');
  const cartItemsEl = document.getElementById('cartItems');
  const totalLabel = document.getElementById('totalLabel');
  const msg = document.getElementById('msg');

  let cart = [];

  function renderProducts(){
    productGrid.innerHTML = PRODUCTS.map(p => `
      <div class="card">
        <img src="${p.img}" alt="${p.title}">
        <div class="pad">
          <div class="title">${p.title}</div>
          <div class="price">€ ${p.price.toFixed(2)}</div>
          <button class="btn" onclick='addToCart("${p.id}")'>Buy</button>
        </div>
      </div>
    `).join('');
  }
  renderProducts();

  function addToCart(id){
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;
    cart = [ { ...p } ]; // one-product flow; replace if you want multi
    openCart();
    renderCart();
  }
  function removeFromCart(i){
    cart.splice(i,1);
    renderCart();
  }
  function renderCart(){
    if(cart.length===0){
      cartItemsEl.innerHTML = `<div class="muted">Your cart is empty.</div>`;
      totalLabel.textContent = `Total: € 0.00`;
      return;
    }
    cartItemsEl.innerHTML = cart.map((c,i)=>`
      <div class="cart-item">
        <img src="${c.img || ''}" alt="">
        <div>
          <div><strong>${c.title}</strong></div>
          <div class="muted">€ ${c.price.toFixed(2)}</div>
        </div>
        <div class="right">
          <button class="btn ghost" onclick="removeFromCart(${i})">Remove</button>
        </div>
      </div>
    `).join('');
    const total = cart.reduce((s,x)=>s+x.price,0);
    totalLabel.textContent = `Total: € ${total.toFixed(2)}`;
  }
  function openCart(){ cartEl.classList.add('open'); }
  function closeCart(){ cartEl.classList.remove('open'); }
  document.getElementById('openCart').onclick=openCart;
  document.getElementById('closeCart').onclick=closeCart;

  /* ============================
     3) CHECKOUT FLOW
     ============================ */
  document.getElementById('checkoutBtn').addEventListener('click', async ()=>{
    msg.textContent='';
    const name = (document.getElementById('buyerName').value || '').trim();
    const email = (document.getElementById('buyerEmail').value || '').trim();

    if(!cart.length){ msg.innerHTML = '<span class="error">Your cart is empty.</span>'; return; }
    if(!email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){
      msg.innerHTML = '<span class="error">Please enter a valid email.</span>'; return;
    }

    // Save for success page
    localStorage.setItem('lastOrder', JSON.stringify(cart));

    try{
      const res = await fetch('/.netlify/functions/create-checkout', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
          mode: MODE,
          items: cart.map(c => ({title:c.title, price:c.price, qty:1})),
          customer: {name, email},
          successUrl: location.origin + '/success.html',
          cancelUrl: location.href
        })
      });

      if(!res.ok){
        const t = await res.text();
        throw new Error(t || 'Checkout function returned an error');
      }
      const { id } = await res.json();
      const result = await stripe.redirectToCheckout({ sessionId: id });
      if(result.error) throw result.error;

    }catch(err){
      console.error('Checkout error:', err);
      msg.innerHTML = '<span class="error">Checkout error. Please try again or contact us.</span>';
      // Uncomment if you still want fallback during development:
      // location.href = 'success.html';
    }
  });
  </script>
</body>
</html>
