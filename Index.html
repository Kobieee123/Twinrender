<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Twinrender ‚Äì Shop</title>

  <!-- Favicon / tab icon -->
  <link rel="icon" href="Images/logo.png" type="image/png" />
  <meta name="theme-color" content="#8FAFD8" />

  <!-- Stripe -->
  <link rel="preconnect" href="https://js.stripe.com">
  <script src="https://js.stripe.com/v3/"></script>

  <style>
    :root{
      --brand:#8FAFD8;         /* your logo blue */
      --brand-strong:#6F93CC;

      --bg:#ffffff;            /* white site */
      --ink:#111111;           /* black text */
      --muted:#6b7280;

      --card:#ffffff;
      --line:#e5e7eb;

      --btn:#111111;
      --btn-on:#ffffff;
      --btn-ghost:#ffffff44;
    }

    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    h1,h2,h3,p{margin:0}
    a{color:inherit; text-decoration:none}

    /* ====== HEADER (two rows) ====== */
    header{border-bottom:1px solid var(--line); background:var(--brand); color:#fff;}
    .header-wrap{max-width:1200px; margin:0 auto; padding:10px 16px;}

    /* Row 1: brand + search + mini cart */
    .row1{
      display:grid;
      grid-template-columns: 1fr auto auto;
      gap:16px; align-items:center;
    }
    .brand{
      display:flex; align-items:center; gap:12px; min-width:0;
    }
    .brand img{width:36px; height:36px; object-fit:contain; display:block}
    .brand-text{display:flex; flex-direction:column; min-width:0}
    .brand-text .site{font-size:22px; font-weight:800; line-height:1}
    .brand-text .tag{font-size:12px; opacity:.9; margin-top:4px}

    .search{
      width:min(520px, 100%); display:flex; align-items:center;
      background:#fff; border-radius:10px; overflow:hidden;
      border:1px solid #0000;
    }
    .search input{
      width:100%; border:0; outline:none; padding:10px 12px;
      font:inherit; color:#111;
    }

    .minicart{
      display:flex; align-items:center; gap:8px;
      cursor:pointer; background:#ffffff18; border:1px solid #ffffff55;
      padding:8px 12px; border-radius:10px;
    }
    .minicart .price{font-weight:700}
    .minicart .items{opacity:.9; font-size:12px}

    /* Row 2: nav links */
    .row2{
      margin-top:12px; display:flex; align-items:center; gap:18px;
    }
    .row2 a{
      color:#fff; padding:8px 10px; border-radius:8px;
    }
    .row2 a:hover{background:#ffffff22}

    /* Main container */
    .wrap{max-width:1100px; margin:26px auto; padding:0 16px}

    /* Intro banner (brand color) */
    .intro{
      background:var(--brand); color:#fff;
      border-radius:16px; padding:22px; margin-bottom:26px;
    }
    .intro h2{margin-bottom:8px}
    .intro p{opacity:.95}
    .intro ul{margin:12px 0 10px 1.2rem; padding:0}
    .intro li{margin:6px 0}
    .intro .explain{margin-top:10px; opacity:.95; line-height:1.5}

    /* Section head */
    .section-head{display:flex; align-items:baseline; justify-content:space-between; margin:18px 0 12px}
    .section-head h2{font-size:22px}

    /* Product grid ‚Äî 3 across like the reference */
    .grid{display:grid; gap:22px; grid-template-columns:repeat(auto-fit, minmax(260px, 1fr))}
    @media (min-width:1050px){ .grid{grid-template-columns:repeat(3, 1fr)} }

    .card{
      background:var(--card); border:1px solid var(--line);
      border-radius:16px; overflow:hidden; display:flex; flex-direction:column;
      transition:box-shadow .15s ease, transform .15s ease;
    }
    .card:hover{box-shadow:0 6px 18px rgba(0,0,0,.06); transform:translateY(-2px)}
    .media{position:relative; background:#f6f7fb}
    .card img{width:100%; aspect-ratio:1/1; object-fit:cover; display:block} /* perfect square */
    .pad{padding:14px}
    .title{font-weight:700; margin-bottom:6px}
    .price{color:var(--muted); margin-bottom:10px}
    .buy{background:var(--ink); color:#fff; width:100%; border:0; border-radius:10px; padding:10px 14px; font-weight:700; cursor:pointer}

    /* Cart drawer (light) */
    aside.cart{
      position:fixed; top:0; right:0; width:360px; max-width:90vw; height:100dvh;
      background:#fff; color:var(--ink); border-left:1px solid var(--line);
      box-shadow:-10px 0 30px rgba(0,0,0,.08);
      transform:translateX(100%); transition:.25s; display:flex; flex-direction:column;
    }
    aside.cart.open{transform:translateX(0)}
    .cart-head{display:flex; justify-content:space-between; align-items:center; padding:16px; border-bottom:1px solid var(--line)}
    .cart-body{padding:12px; gap:10px; display:flex; flex-direction:column; overflow:auto}
    .cart-item{display:flex; gap:10px; padding:10px; border:1px solid var(--line); border-radius:12px; background:#fafafa}
    .cart-item img{width:64px; height:64px; object-fit:cover; border-radius:8px; background:#eee}
    .right{margin-left:auto; text-align:right}
    .input{width:100%; padding:10px; border-radius:8px; border:1px solid var(--line); background:#fff; color:var(--ink)}
    .total{margin:8px 0 14px; font-weight:700}
    .muted{color:var(--muted)}
    .footer-note{color:var(--muted); font-size:12px; margin-top:6px}
  </style>
</head>
<body>

  <!-- ===== HEADER ===== -->
  <header>
    <div class="header-wrap">

      <!-- Row 1 -->
      <div class="row1">
        <div class="brand">
          <img src="Images/logo.png" onerror="this.onerror=null;this.src='images/logo.png'" alt="Twinrender logo">
          <div class="brand-text">
            <div class="site">Twinrender</div>
            <div class="tag">Ready to use with Twinmotion</div>
          </div>
        </div>

        <!-- Search (cosmetic) -->
        <form class="search" action="#" role="search">
          <input type="search" placeholder="Search products‚Ä¶" aria-label="Search products">
        </form>

        <!-- Mini cart summary -->
        <div class="minicart" id="miniCartBtn" title="Open cart">
          <span class="price" id="miniPrice">0.00 ‚Ç¨</span>
          <span class="items" id="miniItems">0 items</span>
          <span aria-hidden="true">üß∫</span>
        </div>
      </div>

      <!-- Row 2 -->
      <nav class="row2" aria-label="Primary">
        <a href="index.html">Shop</a>
        <a href="https://www.instagram.com/archiprogress" target="_blank" rel="noopener">My account</a>
        <a href="#" id="contactLink">Contact</a>
        <a href="#" id="termsLink">Terms of use</a>
      </nav>
    </div>
  </header>

  <!-- ===== PAGE ===== -->
  <main class="wrap">

    <!-- Intro banner -->
    <section class="intro" aria-labelledby="introTitle">
      <h2 id="introTitle">Skip the setup. Start rendering.</h2>
      <p>When you purchase, you get the exact Twinmotion source file of the render images shown. Use it as your shortcut to high-quality results:</p>
      <ul>
        <li>üìÇ Replace my model with yours ‚Äì all settings stay in place</li>
        <li>üí° Perfectly tuned lighting, cameras and environments</li>
        <li>üé® Realistic materials and textures ready to go</li>
        <li>‚è±Ô∏è Save hours of trial & error ‚Äì render professional images instantly</li>
        <li>‚ú® Learn from a complete example and improve your own workflow</li>
      </ul>
      <p class="explain">
        Each scene is a ready-to-render Twinmotion project with the models, materials, lighting and camera setups exactly as shown.
        No Photoshop tricks ‚Äî what you see is what you get. Perfect for visualizers and architects who want consistent,
        high-quality results fast. Drop your own project into the scene and render great images right away.
      </p>
    </section>

    <!-- Products -->
    <div class="section-head">
      <h2>Products</h2>
    </div>

    <div class="grid" id="productGrid"></div>
  </main>

  <!-- ===== CART DRAWER ===== -->
  <aside class="cart" id="cart" aria-label="Shopping cart">
    <div class="cart-head">
      <strong>Your cart</strong>
      <button class="buy" style="background:#eee;color:#111" id="closeCart">Close</button>
    </div>
    <div class="cart-body">
      <div id="cartItems"></div>

      <div class="muted">Name</div>
      <input class="input" id="buyerName" placeholder="Your name"/>
      <div class="muted">Email</div>
      <input class="input" id="buyerEmail" placeholder="you@example.com"/>

      <div class="total" id="totalLabel">Total: ‚Ç¨ 0.00</div>
      <button id="checkoutBtn" class="buy">Checkout</button>
      <div class="footer-note" id="msg"></div>
    </div>
  </aside>

  <script>
  /* ============================
     1) SIMPLE TEST/LIVE TOGGLE
     ============================ */
  const MODE = "test"; // <<< "test" or "live"

  const STRIPE_PUBLISHABLE = {
    test: "pk_test_51RxuD8HoOWyFBTgUahIOlF5pVwHqjSoGiG14HULLaNbso9zK9LtOtSOhuDZVReOt1gAusMPKJGT6UoSGBoejozvM00kSsc8Qvr",
    live: "pk_live_51RxuD8HoOWyFBTgU1X8zPjcFWis7i0tbg0tGmxcxvaoYYJBMct84LRKCBzswNZcAHGv8uOLCCrxy2KXmsttFhLOz003YcvJZjL"
  };
  const stripe = Stripe(STRIPE_PUBLISHABLE[MODE]);

  /* ============================
     2) PRODUCTS
     ============================ */
  const PRODUCTS = [
    {
      id: "RT-0001",
      title: "Rooftop Terras (Twinmotion)",
      price: 29.00,
      img: "Images/rooftop-terras.jpg",     // square recommended
      fileId: "1oOgTasMp1O11TNoixu4ScY3v4unceO6V",
      filename: "Rooftop-Terras.zip"
    }
  ];

  /* ======= CART RUNTIME ======= */
  const productGrid = document.getElementById('productGrid');
  const cartEl = document.getElementById('cart');
  const cartItemsEl = document.getElementById('cartItems');
  const totalLabel = document.getElementById('totalLabel');
  const msg = document.getElementById('msg');
  const miniPrice = document.getElementById('miniPrice');
  const miniItems = document.getElementById('miniItems');
  const miniCartBtn = document.getElementById('miniCartBtn');

  let cart = []; // {id, title, price, img, fileId, filename}

  function renderProducts(){
    productGrid.innerHTML = PRODUCTS.map(p => `
      <article class="card">
        <div class="media">
          <img src="${p.img}" alt="${p.title}"
               onerror="this.onerror=null;this.src=this.src.toLowerCase();">
        </div>
        <div class="pad">
          <div class="title">${p.title}</div>
          <div class="price">‚Ç¨ ${p.price.toFixed(2)}</div>
          <button class="buy" onclick='addToCart("${p.id}")'>Add to cart</button>
        </div>
      </article>
    `).join('');
  }
  renderProducts();

  function addToCart(id){
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;
    cart.push({...p});
    openCart();
    renderCart();
  }
  function removeFromCart(i){
    cart.splice(i,1);
    renderCart();
  }

  function updateCartSummary(){
    const total = cart.reduce((s,x)=>s+x.price,0);
    const count = cart.length;
    miniPrice.textContent = `${total.toFixed(2)} ‚Ç¨`;
    miniItems.textContent = `${count} ${count===1?'item':'items'}`;
    totalLabel.textContent = `Total: ‚Ç¨ ${total.toFixed(2)}`;
  }

  function renderCart(){
    if(cart.length===0){
      cartItemsEl.innerHTML = `<div class="muted">Your cart is empty.</div>`;
      updateCartSummary();
      return;
    }
    cartItemsEl.innerHTML = cart.map((c,i)=>`
      <div class="cart-item">
        <img src="${c.img || ''}" onerror="this.onerror=null;this.src=this.src.toLowerCase();">
        <div>
          <div><strong>${c.title}</strong></div>
          <div class="muted">‚Ç¨ ${c.price.toFixed(2)}</div>
        </div>
        <div class="right">
          <button class="buy" style="background:#eee;color:#111" onclick="removeFromCart(${i})">Remove</button>
        </div>
      </div>
    `).join('');
    updateCartSummary();
  }

  function openCart(){ cartEl.classList.add('open'); }
  function closeCart(){ cartEl.classList.remove('open'); }
  document.getElementById('closeCart').onclick = closeCart;
  miniCartBtn.onclick = openCart;

  /* ============================
     3) CHECKOUT FLOW
     ============================ */
  document.getElementById('checkoutBtn').addEventListener('click', async ()=>{
    msg.textContent='';
    const name = document.getElementById('buyerName').value.trim();
    const email = document.getElementById('buyerEmail').value.trim();
    if(!cart.length){ msg.textContent = "Your cart is empty."; return;}
    if(!email){ msg.textContent = "Please enter your email."; return;}

    localStorage.setItem('lastOrder', JSON.stringify(cart));

    try{
      const res = await fetch('/.netlify/functions/create-checkout', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
          mode: MODE,
          items: cart.map(c => ({title:c.title, price:c.price, qty:1})),
          customer: {name, email},
          successUrl: location.origin + '/success.html',
          cancelUrl: location.href
        })
      });

      if(!res.ok){
        throw new Error(await res.text());
      }
      const {id} = await res.json();
      const result = await stripe.redirectToCheckout({ sessionId: id });
      if(result.error) throw result.error;

    }catch(err){
      console.warn('Checkout error, going to success test flow:', err);
      location.href = 'success.html';
    }
  });

  // initialize summary on load
  updateCartSummary();
  </script>
</body>
</html>
