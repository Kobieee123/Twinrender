<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Order Success – Twinrender</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:#0b0f1a;color:#e7edf6;margin:0;display:flex;align-items:center;justify-content:center;min-height:100dvh}
    .card{max-width:680px;width:100%;background:#0f1628;padding:28px;border-radius:16px;border:1px solid rgba(255,255,255,.1)}
    a{color:#7aa2ff;text-decoration:none}
    .downloads a{display:block;margin:6px 0;padding:10px 14px;background:#0b1224;border:1px solid rgba(255,255,255,.1);border-radius:10px}
  </style>
</head>
<body>
  <div class="card">
    <h1>✅ Thank you for your purchase!</h1>
    <p>Your payment was successful. Your downloads will start automatically.</p>
    <div id="auto"></div>
    <div class="downloads" id="downloads"></div>
    <p><a href="index.html">⬅ Back to shop</a></p>
  </div>

<script>
const order = JSON.parse(localStorage.getItem('lastOrder')||'[]');
const downloads = document.getElementById('downloads');
const auto = document.getElementById('auto');

if(order.length){
  // Toon fallback links én start direct downloaden via proxy
  downloads.innerHTML = order.map(p => {
    const url = `/.netlify/functions/gdrive-proxy?fileId=${encodeURIComponent(p.fileId)}&filename=${encodeURIComponent(p.filename||'download.zip')}`;
    return `<a href="${url}">${p.title} – download</a>`;
  }).join('');

  // Autostart: download eerste item
  const first = order[0];
  const link = document.createElement('a');
  link.href = `/.netlify/functions/gdrive-proxy?fileId=${encodeURIComponent(first.fileId)}&filename=${encodeURIComponent(first.filename||'download.zip')}`;
  link.download = first.filename || 'download.zip';
  document.body.appendChild(link);
  link.click();
  link.remove();

  auto.innerHTML = `<p class="muted">Starting download… If nothing happens, use the links below.</p>`;
  localStorage.removeItem('lastOrder');
}else{
  downloads.innerHTML = `<em>No order found.</em>`;
}
</script>
</body>
</html>
