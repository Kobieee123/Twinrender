<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Twinrender – Shop</title>
  <meta name="description" content="Ready-to-render Twinmotion scenes. Add to cart and pay once via Stripe Checkout." />
  <link rel="icon" href="data:,">
  <style>
    :root{--bg:#0b0f1a;--card:#0f1628;--muted:#9fb0c7;--text:#e7edf6;--line:rgba(255,255,255,.08);--brand:#7aa2ff;--danger:#ef4444}
    *{box-sizing:border-box} body{margin:0;font:16px/1.6 system-ui,-apple-system,Segoe UI,Inter,Roboto,Ubuntu,Arial;color:var(--text);background:#0b0f1a}
    a{color:inherit} .wrap{max-width:1180px;margin:0 auto;padding:24px}
    header.top{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;gap:10px;align-items:center}.logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#7aa2ff,#4de6a9)}
    nav a{opacity:.9;text-decoration:none;padding:8px 10px;border-radius:10px} nav a:hover{background:rgba(255,255,255,.06)}
    .hero{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:22px;display:grid;gap:10px}
    .hero h1{margin:0;font-size:clamp(22px,4vw,34px)} .hero p{margin:0;color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;margin-top:20px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
    .thumb{aspect-ratio:16/9;background:#131b2e}.thumb img{width:100%;height:100%;object-fit:cover}
    .body{padding:12px 14px;display:grid;gap:6px}.title{font-weight:700}.price{font-weight:800}
    .actions{display:flex;gap:8px;margin-top:8px}
    .btn{border:0;border-radius:12px;padding:10px 12px;font-weight:700;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;justify-content:center}
    .btn.primary{background:linear-gradient(180deg,#7aa2ff,#567fff);color:#0b0f1a}
    .btn.ghost{background:#10182b;color:#d9e5ff;border:1px solid var(--line)}
    .btn.remove{background:var(--danger);color:#fff}

    .cart-btn{position:relative}.cart-count{position:absolute;right:-6px;top:-6px;background:#ef4444;color:#fff;border-radius:999px;padding:2px 6px;font-size:12px;min-width:18px;text-align:center}

    .drawer{position:fixed;inset:0;display:none}.drawer.open{display:block}
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,.52)}
    .panel{position:absolute;right:0;top:0;height:100%;width:min(500px,100%);background:#0d1424;border-left:1px solid var(--line);display:flex;flex-direction:column}
    .panel header{padding:16px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .panel h2{margin:0;font-size:20px}
    .panel .content{padding:16px;display:grid;gap:14px;overflow:auto}
    .cart-item{display:flex;gap:10px;align-items:center;border:1px solid var(--line);border-radius:12px;padding:10px}
    .cart-item img{width:84px;height:56px;object-fit:cover;border-radius:8px}
    .cart-item .price{margin-left:auto;font-weight:700}
    .totals{display:flex;justify-content:space-between;border-top:1px solid var(--line);padding-top:10px;margin-top:6px}
    footer{opacity:.7;margin-top:24px}
  </style>
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
  <div class="wrap">
    <header class="top">
      <div class="brand"><div class="logo"></div><strong>Twinrender</strong></div>
      <nav>
        <a href="#">Shop</a>
        <a class="cart-btn btn ghost" id="openCart" href="#">Cart <span class="cart-count" id="cartCount">0</span></a>
        <a href="mailto:Twinrender@hotmail.com">Contact</a>
      </nav>
    </header>

    <section class="hero">
      <h1>Twinmotion Scenes – Ready to Render</h1>
      <p>Add products to your cart and pay <strong>once</strong> via Stripe Checkout. Adding new products later is just adding one more object below.</p>
    </section>

    <section class="grid" id="grid"></section>

    <footer>
      <div>Prices include VAT. Delivery via download link on the success page (or by email if you prefer later).</div>
      <div>© Twinrender</div>
    </footer>
  </div>

  <!-- Cart Drawer -->
  <div class="drawer" id="drawer">
    <div class="overlay" id="closeCart"></div>
    <aside class="panel">
      <header>
        <h2>Your cart</h2>
        <button class="btn ghost" id="closeBtn">Close</button>
      </header>
      <div class="content">
        <div id="cartItems"></div>
        <div class="totals"><strong>Total</strong><strong id="totalPrice">€ 0.00</strong></div>
        <button class="btn primary" id="checkoutBtn">Checkout</button>
      </div>
    </aside>
  </div>

  <script>
    // ===== PRODUCTS — EDIT BELOW =====
    // id, title, price (EUR), img (thumbnail), file (download link), desc (optional)
    const products = [
      {
        id: 'RT-0001',
        title: 'Rooftop Terras (Twinmotion)',
        price: 29,
        img: 'images/rooftop-terras.jpg',
        file: 'downloads/rooftop-terras.tm',
        desc: 'Ready-to-render rooftop scene for Twinmotion.'
      }
      // ,{
      //   id: 'UP-0002',
      //   title: 'Urban Plaza – Golden Hour (Twinmotion)',
      //   price: 49,
      //   img: 'images/urban-plaza.jpg',
      //   file: 'https://studenthowest-my.sharepoint.com/:u:/g/personal/kobe_mertens_student_howest_be/ERpKr7NvAFBLlSwXKAHfc-AB4wdpC0YRh2w8Dvb85rBGXw?e=2tFcw0&download=1',
      //   desc: 'Warm lighting + optimized assets.'
      // }
    ];

    // ===== Helpers & State
    let cart = JSON.parse(localStorage.getItem('cart')||'[]');
    const $ = s => document.querySelector(s);
    const grid = $('#grid'), cartItems = $('#cartItems'), cartCount=$('#cartCount'), totalPrice=$('#totalPrice'), drawer=$('#drawer');

    function euro(n){ return `€ ${Number(n).toFixed(2)}`; }

    function render(){
      grid.innerHTML = products.map(p=>`
        <article class="card" data-id="${p.id}">
          <a class="thumb"><img src="${p.img}" alt="${p.title}"></a>
          <div class="body">
            <div class="title">${p.title}</div>
            ${p.desc ? `<div style="color:#9fb0c7;font-size:13px">${p.desc}</div>` : ''}
            <div class="price">${euro(p.price)}</div>
            <div class="actions"><button class="btn primary add">Buy</button></div>
          </div>
        </article>`).join('');
      document.querySelectorAll('.add').forEach(b=>{
        b.onclick=()=>{
          const id=b.closest('article').getAttribute('data-id');
          const p=products.find(x=>x.id===id);
          cart.push(p); update(); openCart();
        };
      });
    }

    function update(){
      cartCount.textContent = cart.length;
      localStorage.setItem('cart', JSON.stringify(cart));
      cartItems.innerHTML = cart.map((i,idx)=>`
        <div class="cart-item">
          <img src="${i.img}">
          <div><strong>${i.title}</strong></div>
          <div class="price">${euro(i.price)}</div>
          <button class="btn remove" onclick="removeItem(${idx})">Remove</button>
        </div>`).join('');
      totalPrice.textContent = euro(cart.reduce((s,i)=>s+i.price,0));
    }
    window.removeItem = idx => { cart.splice(idx,1); update(); };

    function openCart(){ drawer.classList.add('open'); }
    function closeCart(){ drawer.classList.remove('open'); }
    $('#openCart').onclick=e=>{e.preventDefault();openCart();};
    $('#closeCart').onclick=$('#closeBtn').onclick=e=>{e.preventDefault();closeCart();};

    // ===== Stripe (public key only in browser)
    const stripe = Stripe('pk_live_51RxuD8HoOWyFBTgU1X8zPjcFWis7i0tbg0tGmxcxvaoYYJBMct84LRKCBzswNZcAHGv8uOLCCrxy2KXmsttFhLOz003YcvJZjL');

    // ===== Checkout via Netlify Function
    $('#checkoutBtn').onclick = async function(){
      if (!cart.length) return;

      // What we send to the serverless function
      const items = cart.map(p => ({
        title: p.title,
        price: p.price,   // EUR
        quantity: 1
      }));

      // Save files so success.html can show correct links
      const lastOrder = cart.map(p => ({ title: p.title, file: p.file }));
      localStorage.setItem('lastOrder', JSON.stringify(lastOrder));

      try{
        const res = await fetch('/.netlify/functions/create-checkout', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ items })
        });
        const data = await res.json();
        if (data && data.url) {
          cart = []; update(); localStorage.removeItem('cart');
          window.location.href = data.url; // Stripe Checkout
        } else {
          alert('Could not start checkout: ' + (data && data.error ? data.error : 'unknown'));
        }
      }catch(err){
        console.error(err);
        alert('Checkout error: ' + (err.message || err));
      }
    };

    render(); update();
  </script>
</body>
</html>


